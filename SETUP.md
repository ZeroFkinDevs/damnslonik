# damnslonik - Инструкция по настройке онлайн игры

## Обзор системы

Эта система позволяет автоматически собирать и хостить веб-версии игры damnslonik с возможностью игры в разные версии онлайн.

## Компоненты системы

1. **GitHub Actions** - автоматическая сборка игры при обновлениях
2. **Docker + Nginx** - веб-сервер для хостинга версий игры
3. **Веб-интерфейс** - игра онлайн в любую версию
4. **История версий** - отслеживание изменений в игре

## Настройка на сервере

### 1. Установка Docker и Docker Compose

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install docker.io docker-compose-plugin

# CentOS/RHEL
sudo yum install docker docker-compose-plugin

# Запуск Docker
sudo systemctl start docker
sudo systemctl enable docker
```

### 2. Клонирование репозитория

```bash
git clone <your-repo-url> /home/games/damnslonik
cd /home/games/damnslonik
```

### 3. Настройка экспорта Godot

В вашем Godot проекте:

1. Откройте Project → Export
2. Добавьте новый экспорт для Web
3. Настройте параметры экспорта:
   - **Name**: "Web"
   - **Platform**: Web
   - **Custom Features**: оставьте пустым или добавьте нужные
4. Сохраните экспорт пресет
5. Убедитесь, что проект находится в папке `project/` (как указано в `PROJECT_PATH`)

### 4. Настройка GitHub Secrets

В настройках репозитория GitHub добавьте следующие secrets:

- `SERVER_HOST` - IP адрес или домен вашего сервера
- `SERVER_USER` - пользователь для SSH подключения
- `SERVER_SSH_KEY` - приватный SSH ключ для подключения к серверу

### 5. Запуск системы

```bash
# Создание необходимых директорий
mkdir -p builds logs

# Запуск через Docker Compose
sudo docker-compose up -d

# Проверка статуса
sudo docker-compose ps
```

## Использование

### Автоматическая сборка

1. Сделайте коммит и пуш в main ветку
2. GitHub Actions автоматически соберет веб-версию
3. Версия будет доступна на вашем сервере

### Ручная сборка с комментарием

1. Перейдите в Actions в GitHub
2. Выберите "Build and Deploy Godot Web Version"
3. Нажмите "Run workflow"
4. Введите комментарий к версии
5. Нажмите "Run workflow"

### Управление версиями через веб-интерфейс

Откройте `http://your-server.com` в браузере:

- Просмотр всех доступных версий
- Запуск любой версии игры
- Просмотр информации о версиях

### Управление версиями

Все версии создаются автоматически через GitHub Actions. Для ручного управления версиями используйте веб-интерфейс или удаляйте файлы напрямую на сервере.

## Структура файлов

```
/
├── .github/workflows/          # GitHub Actions
├── web-interface/              # Веб-интерфейс
├── scripts/                    # Скрипты (пустая папка)
├── builds/                     # Директория для билдов (монтируется в контейнер)
├── logs/                       # Логи nginx (монтируется в контейнер)
├── Dockerfile                  # Docker образ
├── docker-compose.yml          # Docker Compose конфигурация
├── nginx.conf                  # Конфигурация nginx
└── README.md                   # Эта инструкция
```

## Мониторинг и логи

```bash
# Просмотр логов контейнера
sudo docker-compose logs -f

# Просмотр логов nginx
tail -f logs/access.log
tail -f logs/error.log

# Статус контейнера
sudo docker-compose ps
```

## Безопасность

1. **SSH ключи**: Используйте SSH ключи вместо паролей
2. **Firewall**: Настройте firewall для ограничения доступа
3. **HTTPS**: Настройте SSL сертификат для HTTPS
4. **Резервное копирование**: Регулярно создавайте бэкапы директории builds

## Обновление системы

```bash
# Остановка
sudo docker-compose down

# Обновление кода
git pull

# Пересборка и запуск
sudo docker-compose up -d --build
```

## Устранение неполадок

### Проблема: GitHub Actions не может подключиться к серверу

- Проверьте SSH ключи в GitHub Secrets
- Убедитесь, что сервер доступен по SSH
- Проверьте права пользователя на сервере

### Проблема: Игра не загружается в браузере

- Проверьте CORS настройки в nginx.conf
- Убедитесь, что файлы .wasm и .pck доступны
- Проверьте логи nginx на ошибки

### Проблема: Docker контейнер не запускается

- Проверьте логи: `sudo docker-compose logs`
- Убедитесь, что порт 80 свободен
- Проверьте права доступа к директориям builds и logs

## Дополнительные возможности

### Настройка домена

1. Настройте DNS запись для вашего домена
2. Обновите nginx.conf для работы с доменом
3. Настройте SSL сертификат (Let's Encrypt)

### Интеграция с CI/CD

Система автоматически интегрируется с GitHub Actions, но можно добавить:

- Уведомления в Slack/Discord
- Автоматическое тестирование
- Интеграция с другими платформами

### Масштабирование

Для высоких нагрузок можно:

- Использовать CDN для статических файлов
- Настроить балансировщик нагрузки
- Использовать несколько серверов
